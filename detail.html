<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans:wght@200;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles/reset.css" />
    <link rel="stylesheet" href="./styles/style.css" />
    <link rel="stylesheet" href="./styles/detail.css" />
    <title>Collavie</title>
  </head>

  <body>
    <nav>
      <div class="navBox">
        <h1 class="logo"></h1>
        <form class="searchBox">
          <input
            class="searchInput"
            type="text"
            id="searchInput"
            placeholder="Search Title"
          />
          <button class="searchBtn" type="button" id="searchBtn">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </form>
      </div>
    </nav>

    <section class="panSection">
      <div class="l_wrapper">
        <div class="panel"></div>
      </div>
    </section>
    <section class="coSection" style="display: none">
      <div class="commentWrap"></div>
    </section>
    <button class="btn btn-warning backBtn" type="button" id="back">
      <a href="./index.html">Back</a>
    </button>
    <footer>
      <div class="footerBox">
        <h3 class="logo" id="move-footer"></h3>
        <div class="footerIconBox">
          <a
            href="https://github.com/choisooyoung-dev/a5_team_project"
            class="git"
            ><i class="fa-brands fa-github fooIc"></i
          ></a>
        </div>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script src="js/logo,footer.js"></script>
    <script>
      const options = {
        method: "GET",
        headers: {
          accept: "application/json",
          Authorization:
            "Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0MDUyZDk1YTU1NzM4OTZhOWUyZTRkMDZiYmFjZDkzYSIsInN1YiI6IjY1MmY2NDQ5MGNiMzM1MTZmNjQwYjlkZSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.V-gAyCfvw8yM8Ll7BDo1DEs9CS7vxzStmFhGra5s61g",
        },
      };

      let temp = location.href.split("?");
      // console.log(temp);
      const movieId = temp[1];
      const panel = document.querySelector(".panel");
      const commentWrap = document.querySelector(".commentWrap");

      // getIdFunc() -> drawDetailFunc() 변경
      drawDetailFunc();

      // 댓글 함수 실행
      drawCommentFunc();

      // 상세페이지 그려주는 함수
      async function drawDetailFunc() {
        const response = await fetch(
          `https://api.themoviedb.org/3/movie/${movieId}?language=ko`,
          options
        );
        // console.log(response);
        // console.log(response); // Response {type: 'cors', url: 'https://api.themoviedb.org/3/movie/top_rated?language=ko&page=1', redirected: false, status: 200, ok: true, …}
        // json(클라이언트와 서버 간의 HTTP 통신 위한 텍스트 데이터 포맷)으로 표기
        const movieData = await response.json();
        console.log(movieData);

        const movieImgSrc = movieData.backdrop_path;
        const movieTitle = movieData.title;
        const movieRating = movieData.vote_average;
        const movieReleaseDate = movieData.release_date;
        const movieOverview = movieData.overview;
        let addhtml = `
        <div class="panel-cover">
            <img
              class="panel-cover-src"
              src="https://image.tmdb.org/t/p/w1280${movieImgSrc}"
              alt=""
            />
          </div>
          <div class="panel-main">
            <div class="panel-contents" style="display: block">
              <h1 class="panel-title">${movieTitle}</h1>
              <div>
                <p>
                  ${movieOverview}
                </p>
              </div>
              <!-- <div class = "panel-btn"><h2>&blacktriangledown;</h2></div> -->
              <div id="commentBtn" class="panel-btn commentCount"><i class="fa-solid fa-comment "></i></div>
            </div>
          </div>
            `;
        panel.innerHTML += addhtml;

        const commentBtn = document.getElementById("commentBtn");
        console.log(commentBtn);
        const coSection = document.querySelector(".coSection");
        commentBtn.addEventListener("click", (e) => {
          e.preventDefault;

          if (coSection.style.display === "none") {
            coSection.style.display = "flex";
          } else {
            coSection.style.display = "none";
          }
        });
      }

      // 리뷰 그려주는 함수
      async function drawCommentFunc() {
        // localStorage part

        // 댓글
        let commentAddHtml = `
       
          <div class="comments">
            <div class="movieId">${movieId}</div>
            <div class="commentCount">
              <i class="fa-solid fa-comment"></i><span>2(리뷰수)</span>
            </div>
            <div class="commentBox">
              <p class="commentUser">작성자</p>
              <span class="commentDate"> 2023-10-26 </span>
              <p class="comment">
                Lorem ipsum dolor sit amet consectetur, adipisicing elit.
                Architecto consectetur quo eaque animi, rem aliquid fugiat natus.
                Temporibus provident est, cum rem beatae sapiente mollitia
                similique quia quod eligendi labore!
              </p>
              <div class="commentBtnWrap">
                <button class="btn btn-warning coUpdateBtn" type="button">
                  수정
                </button>
                <button class="btn btn-warning coDeleteBtn" type="button">
                  삭제
                </button>  
              </div>
            </div>
            <div class="commentBox">
              <p class="commentUser">작성자</p>
              <span class="commentDate"> 2023-10-26 </span>
              <p class="comment">
                Lorem ipsum dolor sit amet consectetur, adipisicing elit.
                Architecto consectetur quo eaque animi, rem aliquid fugiat natus.
                Temporibus provident est, cum rem beatae sapiente mollitia
                similique quia quod eligendi labore!
              </p>
              <div class="commentBtnWrap">
                <button class="btn btn-warning coUpdateBtn" type="button">
                  수정
                </button>
                <button class="btn btn-warning coDeleteBtn" type="button">
                  삭제
                </button>  
              </div>
            </div>

            <div class="commentInputBox">
              <span class="commentUser">
                <input
                  type="text"
                  placeholder="이름을 입력하세요"
                  id="username"
                />
              </span>
             
              <p class="comment">
                <textarea class="review" id="comment" name="review" rows="1" cols="33" placeholder="리뷰를 작성해주세요"></textarea>
              </p>
              <p class="comment">
                <input type="password" class="review" placeholder="비밀번호를 작성해주세요" id="comment" />
              </p>
              <button class="btn btn-warning coSubmitBtn" type="button">
                확인
              </button>
            </div>
          </div>
       
        `;

        commentWrap.innerHTML += commentAddHtml;
      }
    </script>
  </body>
</html>
